# Home Assistant Add-on: HTML-to-# Home Assistant Add-on: HTML-to-Image (H2I)

![Supports amd64 Architecture][amd64-shield]

[amd64-shield]: https://img.shields.io/badge/amd64-yes-green.svg

## About

This Home Assistant add-on provides a local API service to convert HTML code into images. Based on the [bybetas/h2i](https://hub.docker.com/r/bybetas/h2i) Docker image, it offers a simple way to generate dynamic images from HTML content.

Use cases:
- Generate dynamic images for Home Assistant dashboards
- Create visual representations of data
- Generate image cards for notifications
- Create charts and graphs as images
- Integrate with automation workflows

## How to use

Send a POST request to the API endpoint with your HTML content:

```bash
curl -X POST 
  http://homeassistant:5005 
  -H 'Content-Type: application/json' 
  -d '{"html": "<html><body><h1>Hello, World!</h1></body></html>"}' 
  --output my-image.jpg
```

For more information about configuring and using this add-on, see the [documentation](./h2i/DOCS.md).

## Installation

1. Add this repository URL to your Home Assistant instance:
   ```
   https://github.com/guiman87/addon-h2i
   ```
2. Install the "HTML-to-Image (H2I)" add-on from the add-on store.
3. Configure the add-on with your preferred settings.
4. Start the add-on.

## Support

Got questions? Please visit the [Home Assistant community forum](https://community.home-assistant.io/).

## License

This add-on is licensed under Apache License 2.0.

The H2I service (bybetas/h2i) may have its own licensing terms. Please refer to the [original project](https://github.com/bybetas/h2i) for more information.H2I)

This Home Assistant add-on runs the `bybetas/h2i` service, which provides a simple, local API to convert HTML into images. It's designed to be used by other services on your network, such as n8n, for generating dynamic images from HTML code.

## Installation

1.  Add this repository URL to your Home Assistant Supervisor Add-on Store:
    `https://github.com/guiman87/addon-h2i`
2.  Install the **HTML-to-Image (H2I)** add-on.
3.  In the add-on's **Configuration** tab, set a host port (e.g., `5005`) for the service.
4.  Configure the options as needed (quality, width, height, timeout).
5.  Start the add-on.

## Configuration

The add-on offers the following configuration options:

| Option               | Description                                    | Default |
|----------------------|------------------------------------------------|---------|
| quality              | JPEG image quality (1-100)                     | 80      |
| width                | Default image width in pixels                  | 800     |
| height               | Default image height in pixels                 | 600     |
| timeout              | Maximum time to wait for rendering (ms)        | 30000   |
| allow_external_access| Allow connections from outside Home Assistant  | true    |

## Usage

The add-on exposes an HTTP endpoint on the port you configure. You can send a `POST` request with a JSON body containing your HTML, and it will return a JPG image.

### Basic Usage

**Example `curl` command:**

```bash
curl -X POST \
  http://homeassistant.local:5005 \
  -H 'Content-Type: application/json' \
  -d '{"html": "<html><body><h1>Hello, World!</h1></body></html>"}' \
  --output my-image.jpg
```

### Advanced Options

You can override the default width, height, and quality when making a request:

```bash
curl -X POST \
  http://homeassistant.local:5005 \
  -H 'Content-Type: application/json' \
  -d '{
    "html": "<html><body><h1>Hello, World!</h1></body></html>",
    "width": 1200,
    "height": 800,
    "quality": 90
  }' \
  --output my-image.jpg
```

## Using with n8n

To use this addon with n8n:

1. Make sure both the H2I addon and n8n addon are running
2. In your n8n workflow, add an HTTP Request node
3. Configure the HTTP Request node as follows:
   - **Method**: POST
   - **URL**: `http://homeassistant:5005` (use the internal hostname)
   - **Headers**: Add Content-Type: application/json
   - **Body**: JSON object with at least the "html" property
   - **Response Format**: File

Example n8n HTTP Request Body:
```json
{
  "html": "<html><body><h1>Generated by n8n</h1><p>This is a test</p></body></html>",
  "width": 1000,
  "height": 600
}
```

> **Important Note for n8n**: When you get the error "The connection to the server was closed unexpectedly," try using the internal Home Assistant hostname `homeassistant` instead of `homeassistant.local` or an IP address. The internal Docker network should allow n8n to connect directly to the H2I service using this hostname.

## Troubleshooting

### Connection Issues from n8n

If n8n reports "The connection to the server was closed unexpectedly":

1. **Use the internal hostname**: In your n8n HTTP Request node, try using `http://homeassistant:5005` instead of using the external hostname or IP address.

2. **Check logs**: View the logs of both the H2I addon and the n8n addon to see if there are any error messages.

3. **Verify addon is running**: Make sure the H2I addon shows as "Running" in Home Assistant.

4. **Test with simple HTML**: Start with very simple HTML to rule out rendering issues:
   ```json
   {"html": "<html><body><h1>Test</h1></body></html>"}
   ```

5. **Increase timeout values**: Both in the addon configuration and in your n8n HTTP Request node, try increasing timeout values.

6. **Restart the addons**: Sometimes restarting both addons can resolve network connectivity issues.

### General Troubleshooting

1. Check that the port is correctly mapped and not blocked by firewalls
2. Verify that the HTML content is valid
3. Try increasing the timeout value if your HTML is complex
4. Check the addon logs for any error messages
5. Ensure that the H2I container has proper network access
6. If you're trying to include external resources (like images or fonts), make sure they're accessible from the container
